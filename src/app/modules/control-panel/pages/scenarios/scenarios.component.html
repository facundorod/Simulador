<div class="row">
    <div class="col text-right">
        <button class="btn btn-primary save-changes" (click)="onLoadScenarios()"> Load Scenarios </button>
        <button type="submit" *ngIf="formGroup.valid" class="btn btn-primary save-changes"
            (click)="onSaveChanges()">Save
            changes</button>
        <button type="submit" *ngIf="!formGroup.valid" class="btn btn-primary save-changes" (click)="onSaveChanges()"
            disabled>Save
            changes</button>
    </div>
</div>

<table class="table table-hover table-scenarios">
    <thead class="thead-dark">
        <tr>
            <th scope="col">

            </th>
            <th scope="col">
                Name
            </th>
            <th scope="col">
                Description
            </th>
            <th scope="col">
                Arrhythmias
            </th>
            <th scope="col">
                Pathologies
            </th>
            <th scope="col">
                Medications
            </th>
            <th scope="col">

            </th>
            <!-- <th scope="col">

            </th> -->
        </tr>
    </thead>

    <tbody *ngIf="scenariosSelected && scenariosSelected.length > 0">
        <tr *ngFor="let scenario of scenariosSelected; let i = index">
            <td scope="row" class="td-icons">
                <ng-template [ngIf]="isActiveScenario(i)">
                    <button class="btn btn-ligth btn-activate" (click)="onActiveScenario(i)">
                        <img src="https://img.icons8.com/fluency/24/000000/play.png" />
                    </button>
                </ng-template>
                <ng-template [ngIf]="!isActiveScenario(i)">
                    <button class="btn btn-link btn-activate" (click)="onActiveScenario(i)">
                        <img
                            src="https://img.icons8.com/external-bearicons-blue-bearicons/24/000000/external-play-essential-collection-bearicons-blue-bearicons.png" />
                    </button>

                </ng-template>
                <ng-template [ngIf]="isScenarioEdit(i)">
                    <button class="btn btn-link btn-edit" (click)="onEditScenario(i)">
                        <img src="https://img.icons8.com/color/24/000000/settings--v2.png" />
                    </button>
                </ng-template>
                <ng-template [ngIf]="!isScenarioEdit(i)">
                    <button class="btn btn-link btn-edit" (click)="onEditScenario(i)">
                        <img src="https://img.icons8.com/fluency/24/000000/job.png" />
                    </button>
                </ng-template>
            </td>

            <td scope="row" class="td-name">
                {{scenario?.name}}
            </td>
            <td scope="row" class="td-descr">
                {{scenario?.description}}
            </td>
            <td scope="row" class="td-arr">
                <ng-template [ngIf]="scenario.arrhythmias">
                    {{scenario.arrhythmias | arrayJson}}
                </ng-template>
                <ng-template [ngIf]="!scenario.arrhythmias">
                    -
                </ng-template>

            </td>
            <td scope="row" class="td-path">
                <ng-template [ngIf]="scenario.pathologies">
                    {{scenario.pathologies | arrayJson}}
                </ng-template>
                <ng-template [ngIf]="!scenario.pathologies">
                    -
                </ng-template>
            </td>
            <td scope="row" class="td-med">
                <ng-template [ngIf]="scenario.medications">
                    {{scenario.medications | arrayJson: 'medications'}}
                </ng-template>
                <ng-template [ngIf]="!scenario.medications">
                    -
                </ng-template>
            </td>
            <td scope="row">
                <!-- <span> -->
                <button class="btn btn-trash btn-light" (click)="onDelete(i)">
                    <img src="https://img.icons8.com/color/26/000000/trash--v1.png" />
                </button>
                <!-- </span> -->
            </td>

        </tr>


    </tbody>

    <!-- No items found -->
    <tbody *ngIf="!scenariosSelected || scenariosSelected.length == 0">
        <tr>
            <td colspan="12">
                No scenarios available.
            </td>
        </tr>
    </tbody>
    <!-- / No items found -->
</table>

<form [formGroup]="formGroup">


    <!-- Start row -->
    <div class="row row-2">

        <!-- Start medications form-->
        <div class="col-lg-4">
            <label for="medications" class="form-label">Medications</label>
            <table class="table table-med table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">
                            Medication
                        </th>
                        <th scope="col">
                            dose
                        </th>
                        <th scope="col">
                            [unit]
                        </th>
                        <th scope="col-sm">
                            <!-- Delete -->
                        </th>
                    </tr>


                </thead>

                <tbody>

                    <ng-container formArrayName="medications"
                        *ngFor="let group of getFormControlsMedication.controls; let i = index">

                        <tr [formGroupName]="i">

                            <td scope="row">
                                <select class="form-select form-control" formControlName="medication">
                                    <option *ngIf="! group.value.medication" value="" selected>Choose Medication
                                    </option>
                                    <option *ngIf=" group.value.medication " [ngValue]="group.value.medication"
                                        selected>
                                        {{group.value.medication.name}}
                                    </option>
                                    <option *ngFor="let medication of medications" [ngValue]="medication">
                                        {{ medication.name }}
                                    </option>
                                </select>
                            </td>
                            <td scope="row">
                                <input type="text" class="form-control" formControlName="dose">
                            </td>
                            <td scope="row">
                                <input type="text" class="form-control" formControlName="unit">
                            </td>
                            <td scope="row">
                                <button class="btn btn-trash btn-light" (click)="deleteRowMedication(i)">
                                    <img src="https://img.icons8.com/color/26/000000/trash--v1.png" />

                                </button>

                            </td>

                        </tr>

                    </ng-container>


                    <button class="btn btn-add mt-2 ml-1" (click)="addRowMedication()">
                        + Medication
                    </button>
                </tbody>


            </table>
        </div>
        <!-- End medication Form-->

        <!-- Start pathologies form-->
        <div class="col-lg-4">
            <label for="pathologies" class="form-label">Pathologies</label>
            <table class="table table-path table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">
                            Pathology
                        </th>
                        <th scope="col-sm">
                            <!-- Delete -->
                        </th>
                    </tr>
                </thead>

                <tbody>

                    <ng-container formArrayName="pathologies"
                        *ngFor="let group of getFormControlsPathologies.controls; let i = index">
                        <tr [formGroupName]="i">
                            <td scope="row">
                                <select class="form-select form-control" formControlName="pathology">
                                    <option *ngIf="! group.value.pathology" value="" selected>Choose Pathology
                                    </option>
                                    <option *ngIf="group.value.pathology" [ngValue]="group.value.pathology" selected>
                                        {{group.value.pathology.name}}
                                    </option>
                                    <option *ngFor="let pat of pathologies" [ngValue]="pat">
                                        {{ pat.name }}
                                    </option>
                                </select>
                            </td>

                            <td scope="row">
                                <button class="btn btn-trash btn-light" (click)="deleteRowPathology(i)">
                                    <img src="https://img.icons8.com/color/26/000000/trash--v1.png" />

                                </button>

                            </td>

                        </tr>

                    </ng-container>

                    <button class="btn btn-add mt-2 ml-1" (click)="addRowPathology()">
                        + Pathology
                    </button>

                </tbody>

            </table>
        </div>
        <!-- End pathologies form-->

        <!-- Start arrhythmias form-->
        <div class="col-lg-4">
            <label for="arrhythmias" class="form-label">Arrhythmias</label>
            <table class="table-arr table table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">
                            Arrhythmia
                        </th>
                        <th scope="col-sm">
                            <!-- Delete -->
                        </th>
                    </tr>


                </thead>

                <tbody>

                    <ng-container formArrayName="arrhythmias"
                        *ngFor="let group of getFormControlsArrhythmias.controls; let i = index">
                        <tr [formGroupName]="i">
                            <td scope="row">
                                <select class="form-select form-control" formControlName="arrhythmia">
                                    <option *ngIf="! group.value.arrhythmia" value="" selected>Choose Arrhythmia
                                    </option>
                                    <option *ngIf="group.value.arrhythmia" [ngValue]="group.value.arrhythmia" selected>
                                        {{group.value.arrhythmia.name}}
                                    </option>
                                    <option *ngFor="let arr of arrhythmias" [ngValue]="arr">
                                        {{ arr.name }}
                                    </option>
                                </select>
                            </td>

                            <td scope="row">
                                <button class="btn btn-trash btn-light" (click)="deleteRowArrhythmia(i)">
                                    <img src="https://img.icons8.com/color/26/000000/trash--v1.png" />

                                </button>

                            </td>

                        </tr>

                    </ng-container>


                    <button class="btn btn-add mt-2 ml-1" (click)="addRowArrhythmia()">
                        + Arrhythmia
                    </button>
                </tbody>
            </table>
        </div>
        <!-- End arrhythmias form-->



    </div>
</form>
